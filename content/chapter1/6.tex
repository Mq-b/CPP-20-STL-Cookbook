
C++ has provided some form of feature test macros for as long as new features have been added. Beginning with C++20, the process is standardized, and all library feature test macros have been added to the <version> header. This will make it much easier to test for a new feature in your code.

This is a useful feature and it's very simple to use.

\subsubsection{How to do it…}

All feature test macros begin with the prefix \_\_cpp\_. Library features begin with \_\_cpp\_lib\_. Language feature test macros are typically defined by the compiler. Library feature test macros are defined in the new <version> header. Use them as you would any other preprocessor macro:

\begin{lstlisting}[style=styleCXX]
#include <version>
#ifdef __cpp_lib_three_way_comparison
# include <compare>
#else
# error Spaceship has not yet landed
#endif
\end{lstlisting}

In some cases, you can use the \_\_has\_include preprocessor operator (introduced in C++17) to test for the existence of an include file.

\begin{lstlisting}[style=styleCXX]
#if __has_include(<compare>)
# include <compare>
#else
# error Spaceship has not yet landed
#endif
\end{lstlisting}

You can use \_\_has\_include to test for the existence of any header file. Because it's a preprocessor directive, it doesn't require a header of its own to work.

\subsubsection{How it works…}

Generally, you can use the feature test macros by testing for a non-zero value using \#ifdef or \#if defined. Each of the feature test macros has a non-zero value that corresponds to the year and month it was accepted by the standards committee. For example, the \_\_cpp\_lib\_three\_way\_comparison macro has a value of 201907. This means that it was accepted in July 2019.

\begin{lstlisting}[style=styleCXX]
#include <version>
#ifdef __cpp_lib_three_way_comparison
cout << "value is " << __cpp_lib_three_way_comparison << "\n"
#endif
\end{lstlisting}

Output:

\begin{tcblisting}{commandshell={}}
$ ./working
value is 201907
\end{tcblisting}

The value of the macro may be useful in some obscure cases where a feature has changed and you're dependent upon the changes. For most purposes, you can safely ignore the value and just test for non-zero with \#ifdef.

Several websites maintain a complete list of feature test macros. I tend to use cppreference (\url{https://j.bw.org/cppfeature}) but there are others.








